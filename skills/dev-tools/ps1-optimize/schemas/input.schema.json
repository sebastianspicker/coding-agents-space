{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ps1-optimize input",
  "type": "object",
  "additionalProperties": false,
  "required": ["project", "actions"],
  "properties": {
    "project": {
      "type": "object",
      "additionalProperties": false,
      "required": ["root"],
      "properties": {
        "root": { "type": "string", "minLength": 1, "description": "Workspace root inside sandbox (e.g. /workspace)" },
        "psVersion": { "type": "string", "description": "Optional PowerShell version hint (e.g. 7.4)" },
        "modulePaths": { "type": "array", "items": { "type": "string" }, "description": "Extra PSModulePath entries" },
        "includeGlobs": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["**/*.ps1", "**/*.psm1", "**/*.psd1"]
        },
        "excludeGlobs": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["**/node_modules/**", "**/dist/**"]
        }
      }
    },
    "actions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["type"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["debug", "lint", "migrate", "refactor", "codegen", "recommend"]
          },
          "debugLevel": {
            "type": "string",
            "enum": ["quick", "medium", "complex"],
            "default": "quick",
            "description": "Used when type=debug"
          },
          "applyFixes": {
            "type": "boolean",
            "default": false,
            "description": "If true, applies fixes to files (and always emits patches)."
          },
          "lintRules": {
            "type": "array",
            "items": { "type": "string", "enum": ["trim-trailing-whitespace", "final-newline", "no-write-host"] },
            "default": ["trim-trailing-whitespace", "final-newline", "no-write-host"],
            "description": "Used when type=lint"
          },
          "refactorGoals": {
            "type": "array",
            "items": { "type": "string", "enum": ["format-whitespace"] },
            "default": ["format-whitespace"],
            "description": "Used when type=refactor"
          },
          "migrate": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "renameCommands": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["from", "to"],
                  "properties": {
                    "from": { "type": "string", "minLength": 1 },
                    "to": { "type": "string", "minLength": 1 }
                  }
                }
              }
            },
            "description": "Used when type=migrate"
          },
          "codegen": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "kind": { "type": "string", "enum": ["module"], "default": "module" },
              "targetDirs": { "type": "array", "items": { "type": "string" }, "default": ["."] }
            },
            "description": "Used when type=codegen"
          },
          "recommendFocus": {
            "type": "array",
            "items": { "type": "string", "enum": ["security", "compat", "perf", "style"] },
            "default": ["security", "compat"],
            "description": "Used when type=recommend"
          },
          "targets": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "paths": { "type": "array", "items": { "type": "string" } },
              "changedOnly": { "type": "boolean", "default": false, "description": "Currently ignored (use paths instead)." }
            }
          }
        }
      }
    }
  }
}
