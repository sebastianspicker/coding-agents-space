{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ts-optimize input",
  "type": "object",
  "additionalProperties": false,
  "required": ["project", "actions"],
  "properties": {
    "project": {
      "type": "object",
      "additionalProperties": false,
      "required": ["root"],
      "properties": {
        "root": { "type": "string", "minLength": 1, "description": "Workspace root inside sandbox (e.g. /workspace)" },
        "tsconfigPath": { "type": "string", "description": "Optional path to tsconfig.json" },
        "includeGlobs": { "type": "array", "items": { "type": "string" }, "default": ["**/*.ts", "**/*.tsx", "**/*.mts", "**/*.cts"] },
        "excludeGlobs": { "type": "array", "items": { "type": "string" }, "default": ["**/node_modules/**", "**/dist/**"] }
      }
    },
    "actions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["type"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["debug", "dedupe", "refactor", "recommend", "lint", "migrate", "codegen"]
          },

          "debugLevel": {
            "type": "string",
            "enum": ["quick", "medium", "complex"],
            "default": "quick",
            "description": "Used when type=debug"
          },

          "applyFixes": {
            "type": "boolean",
            "default": false,
            "description": "If true, applies fixes to files (and always emits patches)."
          },

          "refactorGoals": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "extract-functions",
                "inline-trivial",
                "reduce-any",
                "tighten-types",
                "remove-dead-code",
                "simplify-control-flow",
                "improve-immutability",
                "prefer-const"
              ]
            },
            "default": ["prefer-const"],
            "description": "Used when type=refactor"
          },

          "dedupe": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "minTokens": { "type": "integer", "minimum": 20, "maximum": 400, "default": 60 },
              "maxCandidates": { "type": "integer", "minimum": 50, "maximum": 5000, "default": 800 },
              "strategy": { "type": "string", "enum": ["token-hash", "ast-shape"], "default": "token-hash" }
            }
          },

          "recommendFocus": {
            "type": "array",
            "items": { "type": "string", "enum": ["web", "node", "numerics", "perf", "bundle", "types", "testing"] },
            "default": ["perf", "types"],
            "description": "Used when type=recommend"
          },
          "lintRules": {
            "type": "array",
            "items": { "type": "string", "enum": ["prefer-const", "no-var"] },
            "default": ["prefer-const", "no-var"],
            "description": "Used when type=lint"
          },
          "migrate": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "renameImports": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["from", "to"],
                  "properties": {
                    "from": {
                      "type": "object",
                      "additionalProperties": false,
                      "required": ["module", "name"],
                      "properties": {
                        "module": { "type": "string", "minLength": 1 },
                        "name": { "type": "string", "minLength": 1 }
                      }
                    },
                    "to": {
                      "type": "object",
                      "additionalProperties": false,
                      "required": ["module", "name"],
                      "properties": {
                        "module": { "type": "string", "minLength": 1 },
                        "name": { "type": "string", "minLength": 1 }
                      }
                    }
                  }
                }
              }
            },
            "description": "Used when type=migrate"
          },
          "codegen": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "kind": { "type": "string", "enum": ["barrel"], "default": "barrel" },
              "targetDirs": { "type": "array", "items": { "type": "string" }, "default": ["."] }
            },
            "description": "Used when type=codegen"
          },

          "targets": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "paths": { "type": "array", "items": { "type": "string" } },
              "changedOnly": { "type": "boolean", "default": false, "description": "Currently ignored (use paths instead)." }
            }
          }
        },
        "allOf": [
          { "if": { "properties": { "type": { "const": "debug" } } }, "then": { "required": ["debugLevel"] } }
        ]
      }
    }
  }
}
